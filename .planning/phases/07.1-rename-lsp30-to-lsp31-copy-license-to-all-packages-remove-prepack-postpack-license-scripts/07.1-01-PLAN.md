---
phase: 07.1-rename-lsp30-to-lsp31-copy-license-to-all-packages-remove-prepack-postpack-license-scripts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/lsp31/package.json
  - packages/lsp31/README.md
  - packages/lsp31/src/index.ts
  - packages/lsp31/src/constants.ts
  - packages/lsp31/src/schemas.ts
  - packages/lsp31/src/types.ts
  - packages/lsp31/src/guards.ts
  - packages/lsp31/src/decode.ts
  - packages/lsp31/src/encode.ts
  - packages/lsp31/src/resolve.ts
  - packages/lsp31/src/decode.test.ts
  - packages/lsp31/src/encode.test.ts
  - packages/lsp31/src/guards.test.ts
  - packages/lsp31/src/resolve.test.ts
  - packages/lsp31/LSP-31-MultiStorageURI.md
  - packages/lsp31/build.config.ts
  - packages/lsp31/tsconfig.json
  - packages/lsp31/vitest.config.ts
  - README.md
  - .gitignore
  - packages/utils/package.json
  - packages/lsp2/package.json
  - packages/lsp3/package.json
  - packages/lsp4/package.json
  - packages/lsp6/package.json
  - packages/lsp23/package.json
  - packages/lsp29/package.json
  - pnpm-lock.yaml
  - packages/utils/LICENSE
  - packages/lsp2/LICENSE
  - packages/lsp3/LICENSE
  - packages/lsp4/LICENSE
  - packages/lsp6/LICENSE
  - packages/lsp23/LICENSE
  - packages/lsp29/LICENSE
  - packages/lsp31/LICENSE
autonomous: true
requirements: [RENAME-01, LICENSE-01, LICENSE-02]

must_haves:
  truths:
    - "Package @chillwhales/lsp31 exists, builds, and all 415+ tests pass"
    - "All exported function/type/schema/constant names use lsp31/Lsp31/LSP31 (no lsp30 remnants)"
    - "LICENSE file is committed in every publishable package directory"
    - "No prepack/postpack LICENSE copy scripts remain in any package.json"
    - "Root README references @chillwhales/lsp31 (not lsp30)"
  artifacts:
    - path: "packages/lsp31/package.json"
      provides: "Renamed package identity"
      contains: "@chillwhales/lsp31"
    - path: "packages/lsp31/src/index.ts"
      provides: "Re-exports all lsp31-named modules"
      contains: "@chillwhales/lsp31"
    - path: "packages/lsp31/src/constants.ts"
      provides: "LSP31 protocol constants"
      contains: "LSP31_RESERVED_PREFIX"
    - path: "packages/utils/LICENSE"
      provides: "Permanent LICENSE in utils package"
    - path: "packages/lsp31/LICENSE"
      provides: "Permanent LICENSE in lsp31 package"
  key_links:
    - from: "packages/lsp31/src/encode.ts"
      to: "packages/lsp31/src/constants.ts"
      via: "import LSP31_RESERVED_PREFIX"
      pattern: "LSP31_RESERVED_PREFIX"
    - from: "packages/lsp31/src/decode.ts"
      to: "packages/lsp31/src/schemas.ts"
      via: "import lsp31EntriesSchema"
      pattern: "lsp31EntriesSchema"
    - from: "packages/lsp31/src/decode.test.ts"
      to: "packages/lsp31/src/decode.ts"
      via: "import parseLsp31Uri, decodeLsp31Uri"
      pattern: "parseLsp31Uri"
---

<objective>
Rename the lsp30 package to lsp31, permanently copy LICENSE into all publishable packages, and remove the prepack/postpack LICENSE copy scripts.

Purpose: The LSP standard number changed from 30 to 31. LICENSE files should be committed directly rather than copied at pack time — simpler, more reliable, and compatible with changesets publish.
Output: @chillwhales/lsp31 package with all renamed exports, LICENSE in 8 packages, no LICENSE scripts.
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->

From packages/lsp30/src/index.ts (current — all will be renamed):
```typescript
export * from "./constants";  // LSP30_RESERVED_PREFIX, KECCAK256_BYTES_METHOD_ID, HASH_LENGTH_PREFIX, MIN_LSP30_URI_LENGTH, LSP30_BACKENDS, LSP30_MIN_ENTRIES
export * from "./decode";     // parseLsp30Uri, decodeLsp30Uri
export * from "./encode";     // computeContentHash, encodeLsp30Uri
export * from "./guards";     // isLsp30Uri
export * from "./resolve";    // selectBackend, resolveUrl
export * from "./schemas";    // lsp30IpfsEntrySchema, lsp30S3EntrySchema, lsp30LumeraEntrySchema, lsp30ArweaveEntrySchema, lsp30EntrySchema, lsp30EntriesSchema, lsp30UriDataSchema
export * from "./types";      // Lsp30IpfsEntry, Lsp30S3Entry, Lsp30LumeraEntry, Lsp30ArweaveEntry, Lsp30Entry, Lsp30Entries, Lsp30UriData, Lsp30Backend, ParsedLsp30Uri
```

Rename mapping (apply systematically):
- `lsp30` → `lsp31` (camelCase — schemas, variables)
- `Lsp30` → `Lsp31` (PascalCase — types)
- `LSP30` → `LSP31` (UPPER_CASE — constants)
- `LSP-30` → `LSP-31` (kebab — spec filename, references)
- `@chillwhales/lsp30` → `@chillwhales/lsp31` (package name)
- `0x0030` → `0x0031` (hex reserved prefix — LSP31 standard number)

All 8 publishable packages have prepack/postpack scripts to remove:
```json
"prepack": "cp ../../LICENSE .",
"postpack": "rm -f LICENSE"
```
Packages: utils, lsp2, lsp3, lsp4, lsp6, lsp23, lsp29, lsp31 (post-rename)
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Rename lsp30 package to lsp31</name>
  <files>
    packages/lsp31/ (renamed from packages/lsp30/)
    packages/lsp31/package.json
    packages/lsp31/README.md
    packages/lsp31/src/index.ts
    packages/lsp31/src/constants.ts
    packages/lsp31/src/schemas.ts
    packages/lsp31/src/types.ts
    packages/lsp31/src/guards.ts
    packages/lsp31/src/decode.ts
    packages/lsp31/src/encode.ts
    packages/lsp31/src/resolve.ts
    packages/lsp31/src/decode.test.ts
    packages/lsp31/src/encode.test.ts
    packages/lsp31/src/guards.test.ts
    packages/lsp31/src/resolve.test.ts
    packages/lsp31/LSP-31-MultiStorageURI.md
    README.md
  </files>
  <action>
    **Step 1: Rename the directory**
    ```bash
    git mv packages/lsp30 packages/lsp31
    ```

    **Step 2: Rename the spec file**
    ```bash
    git mv packages/lsp31/LSP-30-MultiStorageURI.md packages/lsp31/LSP-31-MultiStorageURI.md
    ```

    **Step 3: Update package.json** — change these fields:
    - `"name"`: `"@chillwhales/lsp30"` → `"@chillwhales/lsp31"`
    - `"description"`: `"LSP30 Multi-Storage URI..."` → `"LSP31 Multi-Storage URI..."`
    - `"repository.directory"`: `"packages/lsp30"` → `"packages/lsp31"`
    - `"keywords"`: replace `"lsp30"` with `"lsp31"`

    **Step 4: Rename all exports in source files** using systematic find/replace per file:

    **constants.ts** — replace all occurrences:
    - `LSP30_RESERVED_PREFIX` → `LSP31_RESERVED_PREFIX`
    - `"0x0030"` → `"0x0031"` (the 2-byte reserved prefix changes to match LSP31)
    - `MIN_LSP30_URI_LENGTH` → `MIN_LSP31_URI_LENGTH`
    - `LSP30_BACKENDS` → `LSP31_BACKENDS`
    - `LSP30_MIN_ENTRIES` → `LSP31_MIN_ENTRIES`
    - All `LSP30` in comments → `LSP31`
    - `LSP-30` in @see references → `LSP-31`

    **schemas.ts** — replace all occurrences:
    - `lsp30IpfsEntrySchema` → `lsp31IpfsEntrySchema`
    - `lsp30S3EntrySchema` → `lsp31S3EntrySchema`
    - `lsp30LumeraEntrySchema` → `lsp31LumeraEntrySchema`
    - `lsp30ArweaveEntrySchema` → `lsp31ArweaveEntrySchema`
    - `lsp30EntrySchema` → `lsp31EntrySchema`
    - `lsp30EntriesSchema` → `lsp31EntriesSchema`
    - `lsp30UriDataSchema` → `lsp31UriDataSchema`

    **types.ts** — replace all occurrences:
    - All `lsp30` (camelCase) imports → `lsp31`
    - All `Lsp30` (PascalCase) type names → `Lsp31`
    - `ParsedLsp30Uri` → `ParsedLsp31Uri`

    **guards.ts** — replace:
    - `isLsp30Uri` → `isLsp31Uri`
    - All `LSP30` constant references → `LSP31`
    - All `lsp30`/`LSP30` in comments → `lsp31`/`LSP31`

    **decode.ts** — replace:
    - `parseLsp30Uri` → `parseLsp31Uri`
    - `decodeLsp30Uri` → `decodeLsp31Uri`
    - All `LSP30` constant imports → `LSP31`
    - All `lsp30EntriesSchema` → `lsp31EntriesSchema`
    - `ParsedLsp30Uri` → `ParsedLsp31Uri`
    - `Lsp30Entry` → `Lsp31Entry`
    - All `LSP30` in comments/error messages → `LSP31`

    **encode.ts** — replace:
    - `encodeLsp30Uri` → `encodeLsp31Uri`
    - All `LSP30` constant imports → `LSP31`
    - `lsp30EntriesSchema` → `lsp31EntriesSchema`
    - `Lsp30Entry` → `Lsp31Entry`
    - All `LSP30` in comments → `LSP31`
    - `0x0030` in comments → `0x0031`

    **resolve.ts** — replace:
    - `Lsp30Backend` → `Lsp31Backend`
    - `Lsp30Entry` → `Lsp31Entry`
    - All `LSP30` in comments → `LSP31` (if any)

    **index.ts** — replace:
    - `@chillwhales/lsp30` → `@chillwhales/lsp31` in JSDoc
    - `LSP30` → `LSP31` in comments
    - `LSP-30` → `LSP-31` in @see reference

    **Step 5: Update ALL 4 test files** — apply the same rename mapping:
    - `decode.test.ts`: `parseLsp30Uri` → `parseLsp31Uri`, `decodeLsp30Uri` → `decodeLsp31Uri`, `encodeLsp30Uri` → `encodeLsp31Uri`, all `LSP30` in describe/it strings → `LSP31`
    - `encode.test.ts`: `encodeLsp30Uri` → `encodeLsp31Uri`, `0x0030` in assertions → `0x0031`, all `LSP30` in describe/it strings → `LSP31`
    - `guards.test.ts`: `isLsp30Uri` → `isLsp31Uri`, `encodeLsp30Uri` → `encodeLsp31Uri`, `validLsp30` → `validLsp31`, all `LSP30` in describe/it strings → `LSP31`
    - `resolve.test.ts`: `Lsp30Entry` → `Lsp31Entry`

    **Step 6: Update spec file content** (LSP-31-MultiStorageURI.md):
    - `lip: 30` → `lip: 31`
    - `LSP30` → `LSP31` in title and all body text
    - `MultiStorageURI` name stays the same (it's the value type name, not the standard number)
    - `0x0030` → `0x0031` in the format diagram and references

    **Step 7: Update package README.md**:
    - `@chillwhales/lsp30` → `@chillwhales/lsp31` (title, install command, import statement)
    - `LSP30` → `LSP31` in description
    - `encodeLsp30Uri` → `encodeLsp31Uri`, `parseLsp30Uri` → `parseLsp31Uri` in code example
    - `LSP-30-MultiStorageURI.md` → `LSP-31-MultiStorageURI.md` in spec reference

    **Step 8: Update root README.md**:
    - `[@chillwhales/lsp30](./packages/lsp30)` → `[@chillwhales/lsp31](./packages/lsp31)`
    - Update description if it says "LSP30" → "LSP31"

    **Step 9: Regenerate lockfile**:
    ```bash
    pnpm install
    ```
    This updates pnpm-lock.yaml to reflect the renamed package directory.

    **IMPORTANT:** Do NOT touch build.config.ts, vitest.config.ts, or tsconfig.json — they use generic patterns (`@chillwhales/config/build`, `packages/*`) and need no changes.

    **IMPORTANT:** The `computeContentHash` function name does NOT change — it's not lsp30-specific.
    **IMPORTANT:** The `selectBackend` and `resolveUrl` function names do NOT change — they're generic utilities within the package.
    **IMPORTANT:** The `KECCAK256_BYTES_METHOD_ID` and `HASH_LENGTH_PREFIX` constants do NOT change — they're cryptographic constants shared with LSP2.
  </action>
  <verify>
    <automated>export PATH="/home/coder/.nvm/nvm/versions/node/v24.11.0/bin:$PATH" && cd /home/coder/LSPs && pnpm build && pnpm test && echo "--- Verify no lsp30 remnants in source ---" && ! grep -r "lsp30\|Lsp30\|LSP30\|LSP-30\|@chillwhales/lsp30" packages/lsp31/src/ packages/lsp31/package.json packages/lsp31/README.md README.md --include="*.ts" --include="*.json" --include="*.md" 2>/dev/null && echo "CLEAN: No lsp30 remnants found"</automated>
  </verify>
  <done>
    - `packages/lsp31/` exists with all source, test, and config files
    - `packages/lsp30/` does not exist
    - `@chillwhales/lsp31` in package.json name field
    - All exported names use lsp31/Lsp31/LSP31 naming
    - Reserved prefix is `0x0031`
    - All 415+ tests pass with zero failures
    - Build succeeds with zero warnings
    - Root README links to @chillwhales/lsp31
  </done>
</task>

<task type="auto">
  <name>Task 2: Copy LICENSE to all packages and remove prepack/postpack scripts</name>
  <files>
    .gitignore
    packages/utils/package.json
    packages/lsp2/package.json
    packages/lsp3/package.json
    packages/lsp4/package.json
    packages/lsp6/package.json
    packages/lsp23/package.json
    packages/lsp29/package.json
    packages/lsp31/package.json
    packages/utils/LICENSE
    packages/lsp2/LICENSE
    packages/lsp3/LICENSE
    packages/lsp4/LICENSE
    packages/lsp6/LICENSE
    packages/lsp23/LICENSE
    packages/lsp29/LICENSE
    packages/lsp31/LICENSE
  </files>
  <action>
    **Step 1: Remove the .gitignore entry that blocks package LICENSE files**
    Remove the line `packages/*/LICENSE` from `.gitignore`. This line was added when LICENSE was dynamically copied at prepack/postpack time — no longer needed since we're committing LICENSE permanently.

    **Step 2: Copy the root LICENSE file into all 8 publishable package directories**
    ```bash
    for pkg in utils lsp2 lsp3 lsp4 lsp6 lsp23 lsp29 lsp31; do
      cp LICENSE "packages/$pkg/LICENSE"
    done
    ```
    Each package already lists `"LICENSE"` in its `"files"` array in package.json, so npm pack will include it.

    **Step 3: Remove prepack and postpack scripts from ALL 8 package.json files**
    From each of these package.json files, delete the two script entries:
    ```json
    "prepack": "cp ../../LICENSE .",
    "postpack": "rm -f LICENSE"
    ```
    Packages to edit: `packages/utils/package.json`, `packages/lsp2/package.json`, `packages/lsp3/package.json`, `packages/lsp4/package.json`, `packages/lsp6/package.json`, `packages/lsp23/package.json`, `packages/lsp29/package.json`, `packages/lsp31/package.json`.

    After removing those two lines, the `"scripts"` block in each package should contain only: `build`, `build:watch`, `clean`, `test`, `test:watch`.

    **IMPORTANT:** The `"files"` array already includes `"LICENSE"` in every package.json — do NOT remove it. It ensures LICENSE is in the published tarball.
  </action>
  <verify>
    <automated>export PATH="/home/coder/.nvm/nvm/versions/node/v24.11.0/bin:$PATH" && cd /home/coder/LSPs && echo "--- Check LICENSE exists in all packages ---" && for pkg in utils lsp2 lsp3 lsp4 lsp6 lsp23 lsp29 lsp31; do if [ -f "packages/$pkg/LICENSE" ]; then echo "✓ $pkg/LICENSE exists"; else echo "✗ $pkg/LICENSE MISSING" && exit 1; fi; done && echo "--- Check no prepack/postpack remain ---" && ! grep -r '"prepack"\|"postpack"' packages/*/package.json && echo "CLEAN: No prepack/postpack scripts found" && echo "--- Check .gitignore no longer blocks ---" && ! grep "packages/\*/LICENSE" .gitignore && echo "CLEAN: .gitignore updated" && echo "--- Verify build still works ---" && pnpm build && pnpm test</automated>
  </verify>
  <done>
    - LICENSE file exists in all 8 publishable package directories (committed to git)
    - No `prepack` or `postpack` scripts in any package.json
    - `.gitignore` no longer contains `packages/*/LICENSE`
    - `pnpm build` succeeds
    - `pnpm test` passes (415+ tests)
    - `npm pack --dry-run` in any package still shows LICENSE in tarball
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` — all packages build with zero warnings
2. `pnpm test` — all 415+ tests pass
3. `grep -r "lsp30\|Lsp30\|LSP30" packages/lsp31/src/` — returns no matches (clean rename)
4. `ls packages/lsp30` — directory does not exist
5. `ls packages/*/LICENSE` — shows LICENSE in all 8 package dirs
6. `grep prepack packages/*/package.json` — returns no matches
7. `grep "packages/\*/LICENSE" .gitignore` — returns no matches
</verification>

<success_criteria>
- @chillwhales/lsp31 package exists with all lsp31-named exports
- packages/lsp30 directory is gone
- All 415+ tests pass with lsp31-named imports
- LICENSE committed in all 8 packages, no dynamic copy scripts
- Root README updated to reference lsp31
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-rename-lsp30-to-lsp31-copy-license-to-all-packages-remove-prepublish-postpublish-license-scripts/07.1-01-SUMMARY.md`
</output>

---
phase: 01-build-hardening-shared-configs
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/utils/build.config.ts
  - packages/lsp2/build.config.ts
  - packages/lsp3/build.config.ts
  - packages/lsp4/build.config.ts
  - packages/lsp6/build.config.ts
  - packages/lsp23/build.config.ts
  - packages/lsp29/build.config.ts
  - packages/lsp30/build.config.ts
autonomous: true

must_haves:
  truths:
    - "Every package's build.config.ts is a thin 2-liner calling createBuildConfig()"
    - "pnpm build succeeds across all 8 packages with failOnWarn: true and zero warnings"
    - "No duplicated build settings exist across packages"
  artifacts:
    - path: "packages/utils/build.config.ts"
      provides: "Thin build config for utils"
      contains: "createBuildConfig"
      max_lines: 5
    - path: "packages/lsp2/build.config.ts"
      provides: "Thin build config for lsp2"
      contains: "createBuildConfig"
      max_lines: 5
    - path: "packages/lsp30/build.config.ts"
      provides: "Thin build config for lsp30"
      contains: "createBuildConfig"
      max_lines: 5
  key_links:
    - from: "packages/*/build.config.ts"
      to: "packages/config/src/build.ts"
      via: "import from @chillwhales/config/build"
      pattern: "from ['\"]@chillwhales/config/build['\"]"
    - from: "packages/config/src/build.ts"
      to: "unbuild"
      via: "defineBuildConfig with failOnWarn: true"
      pattern: "failOnWarn.*true"
---

<objective>
Replace all 8 packages' build.config.ts files with thin 2-liners calling createBuildConfig() from the shared config package, fix any build warnings, and ensure all packages build cleanly with failOnWarn: true.

Purpose: Satisfies BUILD-01 (shared build config) and BUILD-03 (failOnWarn: true). This is the most dangerous existing debt — hidden warnings become hard errors.
Output: 8 thin build.config.ts files, zero-warning builds across all packages.
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-build-hardening-shared-configs/01-CONTEXT.md
@.planning/phases/01-build-hardening-shared-configs/01-RESEARCH.md
@.planning/phases/01-build-hardening-shared-configs/01-01-SUMMARY.md
@packages/config/src/build.ts
@packages/utils/build.config.ts
@packages/lsp2/build.config.ts
@packages/lsp6/build.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace all build.config.ts with thin wrappers</name>
  <files>
    packages/utils/build.config.ts
    packages/lsp2/build.config.ts
    packages/lsp3/build.config.ts
    packages/lsp4/build.config.ts
    packages/lsp6/build.config.ts
    packages/lsp23/build.config.ts
    packages/lsp29/build.config.ts
    packages/lsp30/build.config.ts
  </files>
  <action>
Replace every package's `build.config.ts` with the same thin 2-liner:

```typescript
import { createBuildConfig } from "@chillwhales/config/build";

export default createBuildConfig();
```

All 8 packages get the identical file. No package currently needs overrides — they all had the same config (entries: src/index, declaration: compatible, rollup: emitCJS: true, clean: true). The only difference was `failOnWarn: false` which the shared config intentionally changes to `true`.

Note: lsp30's existing config used single quotes while others used double quotes. The shared import standardizes to double quotes. This is intentional — quote style consistency is at Claude's discretion per user decision.
  </action>
  <verify>
For each package, verify the build.config.ts:
1. `wc -l packages/*/build.config.ts` — each file should be ~3 lines
2. `grep "createBuildConfig" packages/*/build.config.ts` — all 8 should match
3. `grep "failOnWarn" packages/*/build.config.ts` — should return NO results (failOnWarn is in the shared config, not in per-package files)
  </verify>
  <done>
All 8 build.config.ts files are thin 2-liners importing and calling createBuildConfig() from @chillwhales/config/build. No duplicated build settings remain.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix build warnings and verify failOnWarn: true</name>
  <files>
    packages/config/src/build.ts
  </files>
  <action>
Run `pnpm build` from root. Since createBuildConfig() sets `failOnWarn: true`, any existing warnings will now cause build failures.

**Warning resolution strategy (per user's locked decision):**
- Fix all existing warnings first. The build MUST succeed with failOnWarn: true.
- Build in dependency order: leaf packages first (utils, lsp2, lsp30), then dependents (lsp3, lsp4, lsp6, lsp23, lsp29).
- If a warning can't be fixed (e.g., third-party dep issue), add an explicit suppression in the shared config's `createBuildConfig()` with a comment explaining why and linking to the upstream issue.

**Expected warning types from unbuild:**
1. **Unused dependencies** — listed in package.json but not imported. Fix: remove from package.json (but verify not used at runtime).
2. **Implicit dependencies** — imported but not in package.json. Fix: add to package.json (using catalog: if applicable).
3. **Missing output files** — entry point not found. Fix: ensure src/index.ts exists and exports correctly.

**Build each package individually** to isolate warnings:
```bash
pnpm --filter @chillwhales/utils build
pnpm --filter @chillwhales/lsp2 build
pnpm --filter @chillwhales/lsp30 build
# ... then dependents
pnpm --filter @chillwhales/lsp3 build
pnpm --filter @chillwhales/lsp4 build
pnpm --filter @chillwhales/lsp6 build
pnpm --filter @chillwhales/lsp23 build
pnpm --filter @chillwhales/lsp29 build
```

Fix each warning before proceeding to the next package. If a package's warning requires a package.json change, make that change and re-run.

After all individual packages pass, run `pnpm build` from root to confirm the full parallel build also passes.

**If no warnings exist** (possible since failOnWarn: false may have been suppressing nothing), this task completes quickly — just confirm the green build.

**IMPORTANT:** If the shared config's `failOnWarn: true` needs to be temporarily set to `false` during debugging, that's fine — but the final state MUST be `true`. The commit that completes this task must have a green build with failOnWarn: true.
  </action>
  <verify>
1. `pnpm build` from root exits with code 0
2. Build output shows no warning lines (grep for "WARN" or "warn" in output)
3. `grep "failOnWarn: true" packages/config/src/build.ts` — confirms the shared config has failOnWarn enabled
4. No per-package build.config.ts overrides failOnWarn (grep confirms)
  </verify>
  <done>
`pnpm build` runs all 8 packages with failOnWarn: true and exits with zero warnings. Any warnings that existed were fixed (or explicitly suppressed with documented reasons). BUILD-01 and BUILD-03 are satisfied.
  </done>
</task>

</tasks>

<verification>
1. Every build.config.ts is a 2-liner calling createBuildConfig() — `grep -c "createBuildConfig" packages/*/build.config.ts` shows 1 for each
2. No duplicated build settings — `grep "failOnWarn\|declaration\|emitCJS\|entries" packages/*/build.config.ts` returns nothing (all in shared config)
3. `pnpm build` passes from root with zero warnings and exit code 0
4. failOnWarn: true is active in the shared config
</verification>

<success_criteria>
1. All 8 packages' build.config.ts are thin 2-liner re-exports of the shared config (no duplicated settings)
2. `pnpm build` from root succeeds with failOnWarn: true and produces zero warnings
3. Any suppressed warnings have comments explaining why and linking to upstream issues
</success_criteria>

<output>
After completion, create `.planning/phases/01-build-hardening-shared-configs/01-02-SUMMARY.md`
</output>
